let sep_scripts={loaded_orders:[],templates:[],construct(){jQuery(document).ready((function(){sep_scripts.set_event_listeners(),sep_scripts.load_template("order_details","order-details.html","templates/backend/components/"),sep_scripts.load_template("single_order","single-order.html","templates/backend/components/");const order_from_url=sep_scripts.get_order_from_url();empty(order_from_url)||sep_scripts.find_orders(order_from_url).then(()=>{sep_scripts.load_single_order(parseInt(order_from_url))})}))},set_event_listeners(){jQuery("#sep-order-search").on("click",e=>{e.preventDefault(),sep_scripts.find_orders()}),jQuery("#order-section-content").on("click",".sep-order-item",e=>{let order_id=jQuery(e.currentTarget).data("order-id");sep_scripts.load_single_order(order_id)}),jQuery("#order-section-content").on("keydown","#picklist_code_input",e=>{if(13!==e.which)return;let barcode=jQuery(e.currentTarget).val(),line_id=jQuery(`[data-product-sku="${barcode}"]`).data("line-id");sep_scripts.picklist_modify_quantity(line_id,"increase"),jQuery(e.currentTarget).val("")}),jQuery("#order-section-content").on("click","#select_another_order",e=>{jQuery("#order-section-content").html(""),jQuery("#sep-order-search-input-container").show()}),jQuery("#order-section-content").on("click","#add-tracking-code-button",e=>{sep_scripts.add_tracking_code()}),jQuery("#order-section-content").on("click",".modify_product_quantity",e=>{let line_id=jQuery(e.currentTarget).data("line-id"),action=jQuery(e.currentTarget).data("action");sep_scripts.picklist_modify_quantity(line_id,action)})},load_template:async(template_id,file_name,path)=>(await sep_scripts.get_template(template_id,file_name,path).then((function(content){return sep_scripts.templates[template_id]=content,!0})),!1),get_template:async(template_id,file,subfolder="")=>empty(sep_scripts.templates[template_id])?response=await jQuery.get(window.sep_plugin_dir_url+subfolder+file,(function(data,textStatus,jqxhr){sep_scripts.templates[template_id]=data})):sep_scripts.templates[template_id],async find_orders(order_id){jQuery("#order-section-content").html(__("Loading orders...","sep"));let send_data=new FormData;if(send_data.append("action","sep_ajax_orders"),empty(order_id)){let value=jQuery("#sep-order-search-input").val();send_data.append("do","get_orders"),send_data.append("search",value)}else send_data.append("do","get_single_order"),send_data.append("order_id",order_id);const ajax_response=await this.load_ajax(send_data),found_orders=this.get_ajax_success_answer(ajax_response);if(!empty(found_orders))return this.loaded_orders=found_orders,await sep_scripts.get_template("order_details","order-details.html","templates/backend/components/").then((function(content){if("object"==typeof found_orders){var output="<h2>"+__("Found Orders","sep")+"</h2>";jQuery.each(found_orders,(index,order)=>{output+=sep_scripts.add_templage_args(content,{order_number:order.id,name:order.billing.first_name+" "+order.billing.last_name,amount:order.total+" "+order.currency,date:order.date_created.date})})}return jQuery("#order-section-content").html(output)}));sep_scripts.display_error(sep_scripts.get_ajax_error_answer(ajax_response),"#order-section-errors")},async load_single_order(order_id){this.loaded_orders.forEach((async function(order_obj){if(order_obj.id===order_id){var order_items=await sep_scripts.display_products_items_box(order_obj.line_items),tracking_data=await sep_scripts.display_tracking_box(order_obj.tracking),status=await sep_scripts.display_status_box(order_obj);await sep_scripts.get_template("single_order","single-order.html","templates/backend/components/").then((function(content){if("object"==typeof order_obj){var output=sep_scripts.add_templage_args(content,{order_id:order_obj.id,billing_address:sep_scripts.get_order_address(order_obj),shipping_address:sep_scripts.get_order_address(order_obj,"shipping"),picklist_content:order_items,tracking_content:tracking_data,status_content:status,order_title:__("Order","sep"),edit_order_text:__("Edit order","sep"),select_another_order_text:__("Select another order","sep"),billing_address_text:__("Billing address","sep"),shipping_address_text:__("Shipping address","sep"),picklist_title:__("Picklist","sep"),tracking_title:__("Shipping tracking","sep"),status_title:__("Order status","sep"),picklist_input_placeholder:__("Scan a product to add it to the picklist","sep")});jQuery("#order-section-content #picklist").html()}jQuery("#sep-order-search-input-container").hide(),jQuery("#order-section-content").html(output)}))}}))},async display_tracking_box(tracking_data){var template=await sep_scripts.get_template("tracking","tracking.html","templates/backend/components/"),list_item_template=await sep_scripts.get_template("tracking_item","tracking-item.html","templates/backend/components/"),output="";return"object"!=typeof tracking_data?__("Error while loading tracking data. Wrong format.","sep"):(empty(tracking_data)||jQuery.each(tracking_data,(index,item)=>{output+=sep_scripts.add_templage_args(list_item_template,{barcode:item.barcode,provider:item.provider})}),sep_scripts.add_templage_args(template,{tracking_btn_text:__("Order tracking","sep"),current_tracking_codes:output,tracking_providers:sep_scripts.get_tracking_providers()}))},get_tracking_providers:()=>'<option value="swiss_post">Die Post</option>',async add_tracking_code(){var barcode=jQuery("#tracking-code-input").val(),provider=jQuery("#tracking-providers").val(),order_id=jQuery("#order-information").data("order-id");if(empty(barcode))return sep_scripts.display_error(__("No barcode given","sep"),"#tracking-codes-errors"),!1;var list_item_template=await sep_scripts.get_template("tracking_item","tracking-item.html","templates/backend/components/");let item=sep_scripts.add_templage_args(list_item_template,{barcode:barcode,provider:provider});jQuery("#current-tracking-codes-container").append(item);let send_data=new FormData;send_data.append("action","sep_ajax_orders"),send_data.append("do","add_tracking_code"),send_data.append("order_id",order_id),send_data.append("barcode",barcode),send_data.append("service_provider",provider);const ajax_response=await this.load_ajax(send_data),has_errors=this.get_ajax_error_answer(ajax_response);empty(has_errors)||sep_scripts.display_error(__("Updating the order failed: %s","sep").replace("%s",has_errors),"#tracking-codes-errors")},async display_products_items_box(products){var output="";if("object"!=typeof products)return __("Error while loading products. Wrong format.","sep");var template=await sep_scripts.get_template("list_products","list-products.html","templates/backend/components/");return jQuery.each(products,(index,item)=>{output+=sep_scripts.add_templage_args(template,{line_id:item.id,sku:item.sku,product_id:item.product_id,name:item.name,quantity:item.quantity,product_meta:sep_scripts.get_product_meta(item.meta_data)})}),output},async display_status_box(order_obj){var template=await sep_scripts.get_template("status_box","status_box.html","templates/backend/components/");return sep_scripts.add_templage_args(template,{order_id:order_obj.id})},get_product_meta(meta){if("object"!=typeof meta)return __("Error while loading product meta. Wrong format.","sep");var output="";return jQuery.each(meta,(index,item)=>{output+=`${item.key} : ${item.value}`}),output},get_order_address(order,type="billing"){if("object"!=typeof order||empty(order[type]))return __("Error while loading address. Wrong format or wrong type.","sep");let address=[];return empty(order[type].first_name)||address.push(`${order[type].first_name} ${order[type].last_name}`),empty(order[type].company)||address.push(order[type].company),empty(order[type].address_1)||address.push(order[type].address_1),empty(order[type].address_2)||address.push(order[type].address_2),empty(order[type].city)||address.push(`${order[type].postcode} ${order[type].city}`),empty(order[type].email)||address.push(order[type].email),empty(order[type].phone)||address.push(order[type].phone),address.join("<br/>")},get_ajax_success_answer(data,only_first=!0){return this.get_ajax_answer(data,"success",only_first)},get_ajax_error_answer(data,only_first=!0){return this.get_ajax_answer(data,"error",only_first)},get_ajax_system_error_answer(data,only_first=!0){return this.get_ajax_answer(data,"system_error",only_first)},display_error(message,field){jQuery(field).append(message)},get_ajax_answer(data,type,only_first=!0){try{var data_obj=JSON.parse(data)}catch(error){return void console.error(error)}if(void 0!==typeof data_obj[type])return only_first?data_obj[type][0]:data_obj[type]},load_ajax:async send_data=>await jQuery.ajax({url:window.ajaxurl,type:"POST",cache:!1,processData:!1,contentType:!1,data:send_data,success:function success(data){},error:function error(data){console.error(__("Failed to get a proper response from the ajax request.","sep"),data)}}),add_templage_args:(template_string,args={})=>(jQuery.each(args,(index,value)=>{template_string=template_string.replaceAll("{{"+index+"}}",value)}),template_string),picklist_modify_quantity(line_id,action="increase"){let current_quant=jQuery(`[data-line-id=${line_id}] .current-quantity`).text();current_quant=parseInt(current_quant);var new_quant="increase"===action?current_quant+1:current_quant-1;new_quant>=0&&jQuery(`[data-line-id=${line_id}] .current-quantity`).text(new_quant.toString()),sep_scripts.picklist_check_quantity(line_id)},picklist_check_quantity(line_id){let current_quant=parseInt(jQuery(`[data-line-id=${line_id}] .current-quantity`).text()),total_quant=parseInt(jQuery(`[data-line-id=${line_id}] .total-quantity`).text());jQuery(`[data-line-id=${line_id}] .quantity`).removeClass("sep-valid","sep-error"),current_quant===total_quant&&jQuery(`[data-line-id=${line_id}] .quantity`).addClass("valid"),current_quant>total_quant&&jQuery(`[data-line-id=${line_id}] .quantity`).addClass("sep-error")},get_order_from_url(){const query=window.location.search,param=new URLSearchParams(query);return param.get("order")}};const{__:__,_x:_x,_n:_n,_nx:_nx}=wp.i18n;function empty(value){return null===value||(void 0===value||0===value.length)}sep_scripts.construct();